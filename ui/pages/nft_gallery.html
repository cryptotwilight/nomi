<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="utf-8">
  <meta name="description" content="Miminium Admin Template v.1">
  <meta name="author" content="Isna Nur Azis">
  <meta name="keyword" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nomi - Gallery</title>
 
    <!-- start: Css -->
    <link rel="stylesheet" type="text/css" href="../asset/css/bootstrap.min.css">

      <!-- plugins -->
      <link rel="stylesheet" type="text/css" href="../asset/css/plugins/font-awesome.min.css"/>
      <link rel="stylesheet" type="text/css" href="../asset/css/plugins/simple-line-icons.css"/>
      <link rel="stylesheet" type="text/css" href="../asset/css/plugins/animate.min.css"/>
      <link rel="stylesheet" type="text/css" href="../asset/css/plugins/fullcalendar.min.css"/>
  <link href="../asset/css/style.css" rel="stylesheet">
  <!-- end: Css -->

  <link rel="shortcut icon" href="../asset/img/logomi.png">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <!--Xrpl -->
        <script src='https://unpkg.com/xrpl@2.1.0-beta.1'></script>
  </head>

<body id="mimin" class="dashboard">
      <!-- start: Header -->
        <nav class="navbar navbar-default header navbar-fixed-top">
          <div class="col-md-12 nav-wrapper">
            <div class="navbar-header" style="width:100%;">
              <div class="opener-left-menu is-open">
                <span class="top"></span>
                <span class="middle"></span>
                <span class="bottom"></span>
              </div>
                <a href="../index.html" class="navbar-brand"> 
                 <b>NOMI</b>
                </a>

              <ul class="nav navbar-nav search-nav">
                <li>
                   <div class="search">
                    <span class="fa fa-search icon-search" style="font-size:23px;"></span>
                    <div class="form-group form-animate-text">
                      <input type="text" class="form-text" required>
                      <span class="bar"></span>
                      <label class="label-search">Type anywhere to <b>Search</b> </label>
                    </div>
                  </div>
                </li>
              </ul>

              <ul class="nav navbar-nav navbar-right user-nav">
                <li></li>
                <li>
                  <button id="connect_xrp" style="margin-top:0px !important;" class="btn-flip btn btn-3d btn-info" data-toggle="modal" data-target="#connect_modal">
              <div class="flip">
                <div class="side">
                  Connect Xrp <span class="fa fa-chevron-circle-right"></span>
                </div>
                <div class="side back">
                  connect to test net?
                </div>
              </div>
              <span class="icon"></span>
            </button>
              </li>
              </ul>
            </div>
          </div>
        </nav>
      <!-- end: Header -->

      <div class="container-fluid mimin-wrapper">
  
          <!-- start:Left Menu -->
          <div id="left-menu">
            <div class="sub-left-menu scroll">
                <ul class="nav nav-list">
                    <li>
                        <div class="left-bg"></div>
                    </li>
                    <li class="time">
                        <h1 class="animated fadeInLeft">21:00</h1>
                        <p class="animated fadeInRight">Sat,October 1st 2029</p>
                    </li>
                    <li class="ripple"><a href="../index.html"><span class="fa fa-dashboard"></span>Dashboard</a></li>
                    <li class="ripple"><a href="nft_gallery.html"><span class="fa fa-image"></span>Gallery</a></li>
                    <li class="ripple"><a href="marketplace.html"><span class="fa fa-cart-plus"></span>Marketplace</a></li>
                    
                </ul>
            </div>
        </div>
          <!-- end: Left Menu -->


          <!-- start: Content -->
            <div id="content">
              <div class="panel box-shadow-none content-header">
                  <div class="panel-body">
                    <div class="col-md-12">
                        <h3 class="animated fadeInLeft">Your NFTs </h3>
                        <p class="animated fadeInDown">
                          Dashboard <span class="fa-angle-right fa"></span> Gallery
                        </p>
                        <p>
                          <span id="show_wallet"></span>
                        </p> 
                    </div>
                  </div>
              </div>
              <div class="col-md-12">
                  <div class="row" id="nft_display">
                   
                  </div>
              
              </div>
              <div> 
                <div class="col-md-6">
                  <div class="row" id="sell_offers_display">
                    sell offers
                  </div>
              </div>
              <div class="col-md-6">
                <div class="row" id="buy_offers_display">
                  buy offers
                </div>
            </div>
              </div>
             
            </div>
          <!-- end: content -->


 
          <!-- end: right menu -->
          
      </div>
      <footer> 
        This is your footer
      </footer>

      <!-- Connect Modal --> 
      <div class="modal fade modal-v2" id="connect_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="col-md-3 modal-content-center">
                    <img src="../asset/img/apple-icon-114x114.png">
                </div>
                <div class="col-md-9 modal-content-right">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <p>Enter you wallet seed.</p>
                    <input id="modal_seed_field" type="text" class="modal-content-right-text-mail" />

                    <select id="modal_select_field"> 
                    <option value="" selected>Select Network</option>
                    <option value="wss://xls20-sandbox.rippletest.net:51233">NFT DEVNET</option>
                    <option value="wss://s.devnet.rippletest.net:51233">DEVNET</option>
                    <option value="wss://s.altnet.rippletest.net:51233">TESTNET</option>
                    <option value="wss://xrplcluster.com">MAINNET</option>
                  </select>
                    <button id="connect_modal_button" class="btn btn-primary" data-dismiss="modal">Connect</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

      <!-- start: Mobile -->
      <div id="mimin-mobile" class="reverse">
        <div class="mimin-mobile-menu-list">
            <div class="col-md-12 sub-mimin-mobile-menu-list animated fadeInLeft">
                <ul class="nav nav-list">
                    <li class="active ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa-home fa"></span>Dashboard 
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                          <li><a href="../dashboard-v1.html">Dashboard v.1</a></li>
                          <li><a href="../dashboard-v2.html">Dashboard v.2</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa-diamond fa"></span>Layout
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../topnav.html">Top Navigation</a></li>
                        <li><a href="../boxed.html">Boxed</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa-area-chart fa"></span>Charts
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../chartjs.html">ChartJs</a></li>
                        <li><a href="../morris.html">Morris</a></li>
                        <li><a href="../flot.html">Flot</a></li>
                        <li><a href="../sparkline.html">SparkLine</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa fa-pencil-square"></span>Ui Elements
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../color.html">Color</a></li>
                        <li><a href="../weather.html">Weather</a></li>
                        <li><a href="../typography.html">Typography</a></li>
                        <li><a href="../icons.html">Icons</a></li>
                        <li><a href="../buttons.html">Buttons</a></li>
                        <li><a href="../media.html">Media</a></li>
                        <li><a href="../panels.html">Panels & Tabs</a></li>
                        <li><a href="../notifications.html">Notifications & Tooltip</a></li>
                        <li><a href="../badges.html">Badges & Label</a></li>
                        <li><a href="../progress.html">Progress</a></li>
                        <li><a href="../sliders.html">Sliders</a></li>
                        <li><a href="../timeline.html">Timeline</a></li>
                        <li><a href="../modal.html">Modals</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                       <span class="fa fa-check-square-o"></span>Forms
                       <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../formelement.html">Form Element</a></li>
                        <li><a href="#">Wizard</a></li>
                        <li><a href="#">File Upload</a></li>
                        <li><a href="#">Text Editor</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa fa-table"></span>Tables
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../datatables.html">Data Tables</a></li>
                        <li><a href="../handsontable.html">handsontable</a></li>
                        <li><a href="../tablestatic.html">Static</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a href="../calendar.html">
                         <span class="fa fa-calendar-o"></span>Calendar
                      </a>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa fa-envelope-o"></span>Mail
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../mail-box.html">Inbox</a></li>
                        <li><a href="../compose-mail.html">Compose Mail</a></li>
                        <li><a href="../view-mail.html">View Mail</a></li>
                      </ul>
                    </li>
                    <li class="ripple">
                      <a class="tree-toggle nav-header">
                        <span class="fa fa-file-code-o"></span>Pages
                        <span class="fa-angle-right fa right-arrow text-right"></span>
                      </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../forgotpass.html">Forgot Password</a></li>
                        <li><a href="../login.html">SignIn</a></li>
                        <li><a href="../reg.html">SignUp</a></li>
                        <li><a href="../article-v1.html">Article v1</a></li>
                        <li><a href="../search-v1.html">Search Result v1</a></li>
                        <li><a href="../productgrid.html">Product Grid</a></li>
                        <li><a href="../profile-v1.html">Profile v1</a></li>
                        <li><a href="../invoice-v1.html">Invoice v1</a></li>
                      </ul>
                    </li>
                     <li class="ripple"><a class="tree-toggle nav-header"><span class="fa "></span> MultiLevel  <span class="fa-angle-right fa right-arrow text-right"></span> </a>
                      <ul class="nav nav-list tree">
                        <li><a href="../view-mail.html">Level 1</a></li>
                        <li><a href="../view-mail.html">Level 1</a></li>
                        <li class="ripple">
                          <a class="sub-tree-toggle nav-header">
                            <span class="fa fa-envelope-o"></span> Level 1
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                          </a>
                          <ul class="nav nav-list sub-tree">
                            <li><a href="../mail-box.html">Level 2</a></li>
                            <li><a href="../compose-mail.html">Level 2</a></li>
                            <li><a href="../view-mail.html">Level 2</a></li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li><a href="../credits.html">Credits</a></li>
                  </ul>
            </div>
        </div>       
      </div>
      <button id="mimin-mobile-menu-opener" class="animated rubberBand btn btn-circle btn-danger">
        <span class="fa fa-bars"></span>
      </button>
       <!-- end: Mobile -->

<!-- start: Javascript -->
<script src="../asset/js/jquery.min.js"></script>
<script src="../asset/js/jquery.ui.min.js"></script>
<script src="../asset/js/bootstrap.min.js"></script>


<!-- plugins -->
<script src="../asset/js/plugins/holder.min.js"></script>
<script src="../asset/js/plugins/moment.min.js"></script>
<script src="../asset/js/plugins/jquery.nicescroll.js"></script>

<script> 
    var client;
    var account;

    var connected; 

    const storage = window.localStorage; 

    const modalConnectButton = document.getElementById("connect_modal_button");
    modalConnectButton.addEventListener('click', connectXRPL);
    modalConnectSelect = document.getElementById("modal_select_field");

    const modalSeedField = document.getElementById("modal_seed_field");
    const showWallet = document.getElementById("show_wallet");

    async function connectXRPL() {
        client = new xrpl.Client(modalConnectSelect.value);
        client.connect()
            .then(function(response) {
                console.log(client.isConnected());
                account = xrpl.Wallet.fromSeed(modalSeedField.value);
                console.log(account);

                client.request({
                    "command": "account_info",
                    "account": account.address,
                    "ledger_index": "validated"
                })
                .then(function(response){
                    console.log(response);
                    showWallet.innerHTML = "Connected Account :: " + account.classicAddress + " Balance :: "+ response.result.account_data.Balance;
                    storage.setItem("xrpl_connection", client);                       
                    listNFTs();
                })
                .catch(function(err){
                    console.log(err);
                })
            })
    }

    async function getClientData() {

        client.request({
                "command": "account_info",
                "account": test_wallet.address,
                "ledger_index": "validated"
            })
            .then(function(response) {
                console.log(response);
            })
            .catch(function(err) {
                console.log(err);
            })
    }

    var nfts;
  
    async function listNFTs() {

        client.request({
            method: "account_nfts",
            account: account.classicAddress
        })
        .then(function(response) {
            console.log(response);
            nfts = response.result.account_nfts; 
            buildDisplay(nfts);  
        })
        .catch(function(err) {
            console.log(err);
        })
    }

  const nftDisplay = document.getElementById("nft_display");

  function buildDisplay(nfts) {
    for(var x = 0; x < nfts.length; x++) {
        var nft = nfts[x];
        build(nft);
        getSellOffers(nft.TokenID);
        getBuyOffers(nft.TokenID);
        
    }
  }    

  function build(nft){ 
        console.log(nft);
        console.log("building ... " + nft);
        var holder = getDiv(); 
        nftDisplay.append(holder);
        holder.setAttribute("class","col-sm-6 col-md-3 product-grid" );
        var nftName = getDiv(); 
        holder.append(nftName);
        nftName.setAttribute("class","col-md-12 product-location");
        var nameField = getSpan();
        nftName.append(nameField)
        nameField.setAttribute("class", "pull-right");
        var txtName = getTextNode("${NFT-NAME}");
        nameField.appendChild(txtName);
        var thumbnail = getDiv();
        holder.append(thumbnail);
        /**
        var price = getDiv(); 
        thumbnail.append(price);
        price.setAttribute("class", "product-price product-price-bottom");
        var h4Price = getH4(); 
        price.append(h4Price);
        var priceTxt = getTextNode("${price}"); 
        price.appendChild(priceTxt);
        */
        var img = getImg();
        thumbnail.appendChild(img);
        //var imgURL = "http://ipfs.io/"+ "${cid}";
        var cid = xrpl.convertHexToString(nft.URI);
        console.log(cid);
        img.setAttribute("src", "http://ipfs.io/ipfs/"+cid);        
        var caption = getDiv(); 
        thumbnail.append(caption);
        caption.setAttribute("class","caption");
        var p = getP(); 
        caption.append(p);
        var a = getA(); 
        p.append(a);
        a.setAttribute("href","javascript:sellToken('" + nft.TokenID + "');");
        a.setAttribute("class", "btn btn-warning");
        a.setAttribute("role", "button");        
        var buttonTxt = getTextNode("sell"); 
        a.append(buttonTxt);

        var input = ce("input");
        p.append(input);
        input.setAttribute("id", nft.TokenID+"");
        input.setAttribute("placeholder", "Enter price");

    }

    function sellToken (tokenID) { 
      console.log("token: " + tokenID);
      const transactionBlob = {
          "TransactionType": "NFTokenCreateOffer",
          "Account": account.classicAddress,
          "TokenID": tokenID,
          "Amount": ge(tokenID).value,
          "Flags": parseInt("8")
      }

      // Submit signed blob --------------------------------------------------------
      var wallet = account;
      client.submitAndWait(transactionBlob,{wallet})
      .then(function(response){
          console.log(response);

      })
      .catch(function(err){
          console.log(err);
      });
  }

  async function getSellOffers(tokenID) {
    console.log("token id: " + tokenID);
      client.request({ method: "nft_sell_offers",
                tokenid: tokenID
              })
              .then(function(response){
                console.log(response);
              })
              .catch(function(err){
                console.log(err);
              })
	}

  async function getBuyOffers(tokeID) { 
    let nftBuyOffers
    
     client.request({ method: "nft_buy_offers",
                      tokenid: tokeID })
    .then(function(response){
        console.log(response);
    })
    .catch(function(err){
      console.log(err);
    });                                     
  }

  function getDiv() { 
    return ce("div");
  }

  function getA() { 
    return ce("a");
  }
  function getP(){
    return ce("p");
  }

  function getImg(){
    return ce("img");
  }

  function getSpan(){
    return ce("span");
  }

  function getH4() { 
    return ce("h4");
  }

  function ce(name) {
    return document.createElement(name);
  }

  function ge(element){
    return document.getElementById(element);
  }

  function getTextNode(data){
    return document.createTextNode(data);
  }


    /*

    <div class="col-sm-6 col-md-3 product-grid">
                      <div class="col-md-12 product-location">
                          <span class="pull-right"><span class="fa-map-marker fa"></span> Banyumas</span>
                      </div>
                      <div class="thumbnail">
                        <div class="product-price product-price-bottom">
                          <h4>$1,716</h4>
                        </div>
                        <img src="../holder.js/250x250" alt="...">
                        <div class="caption">
                          <small>Category</small>
                          <small class="pull-right">
                            <span class="rate fa-star fa"></span>
                            <span class="rate fa-star fa"></span>
                            <span class="rate fa-star fa"></span>
                            <span class="rate fa-star fa"></span>
                            <span class="rate fa-star-half fa"></span>
                          </small>
                          <h4>Product Name</h4>
                          <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis.</p>
                          <p><a href="#" class="btn btn-success" role="button">Buy</a></p>
                        </div>
                      </div>
                    </div>
                    */

  


</script>


<!-- custom -->
<script src="../asset/js/main.js"></script>
<script type="text/javascript">
  $(document).ready(function(){

  });
</script>
<!-- end: Javascript -->
</body>
</html>