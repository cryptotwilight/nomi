<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="description" content="Miminium Admin Template v.1">
    <meta name="author" content="Isna Nur Azis">
    <meta name="keyword" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nomi - Welcom</title>

    <!-- start: Css -->
    <link rel="stylesheet" type="text/css" href="asset/css/bootstrap.min.css">

    <!-- plugins -->
    <link rel="stylesheet" type="text/css" href="asset/css/plugins/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="asset/css/plugins/simple-line-icons.css" />
    <link rel="stylesheet" type="text/css" href="asset/css/plugins/animate.min.css" />
    <link rel="stylesheet" type="text/css" href="asset/css/plugins/fullcalendar.min.css" />

    <link href="asset/css/style.css" rel="stylesheet">
    <!-- end: Css -->

    <!--Xrpl -->
    <script src='https://unpkg.com/xrpl@2.1.0-beta.1'></script>

    <!--Ipfs -->
    <script src="https://unpkg.com/ipfs-http-client-lite/dist/index.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>    
    
    <link rel="shortcut icon" href="asset/img/logomi.png">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="mimin" class="dashboard boxed container padding-0">
    <!-- start: Header -->
    <nav class="navbar container navbar-default header navbar-fixed-top">
        <div class="col-md-12 nav-wrapper">
            <div class="navbar-header" style="width:100%;">
                <div class="opener-left-menu is-open">
                    <span class="top"></span>
                    <span class="middle"></span>
                    <span class="bottom"></span>
                </div>
                <a href="index.html" class="navbar-brand">
                    <b>NOMI</b>
                </a>

                <ul class="nav navbar-nav search-nav">
                    <li>
                        <div class="search">
                            <span class="fa fa-search icon-search" style="font-size:23px;"></span>
                            <div class="form-group form-animate-text">
                                <input type="text" class="form-text" required>
                                <span class="bar"></span>
                                <label class="label-search">Type anywhere to <b>Search</b> </label>
                            </div>
                        </div>
                    </li>
                </ul>

                <ul class="nav navbar-nav navbar-right user-nav">
                    <li>
                        <button id="connect_xrpl_button" style="margin-top:0px !important;" class="btn-flip btn btn-3d btn-info">
                            <div class="flip">
                              <div class="side">
                                  <span id="connect_xrpl_text"></span>                  
                              </div>
                              <div class="side back">
                                <span id="connect_xrpl_back_text"></span>
                              </div>
                            </div>
                            <span class="icon"></span>
                          </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- end: Header -->

    <div class="container-fluid mimin-wrapper bg-light-grey">

        <!-- start:Left Menu -->
        <div id="left-menu">
            <div class="sub-left-menu scroll">
                <ul class="nav nav-list">
                    <li>
                        <div class="left-bg"></div>
                    </li>
                    <li class="time">
                        <h1 class="animated fadeInLeft">21:00</h1>
                        <p class="animated fadeInRight">Sat,October 1st 2029</p>
                    </li>
                    <li class="ripple"><a href="index.html"><span class="fa fa-dashboard"></span>Dashboard</a></li>
                    <li class="ripple"><a href="pages/nft_gallery.html"><span class="fa fa-image"></span>Gallery</a></li>
                    <li class="ripple"><a href="pages/marketplace.html"><span class="fa fa-cart-plus"></span>Marketplace</a></li>
                    
                </ul>
            </div>
        </div>
        <!-- end: Left Menu -->


        <!-- start: content -->
        <div id="content">
            <div class="panel">
                <div class="panel-body">
                    <div class="col-md-6 col-sm-12">
                        <h3 class="animated fadeInLeft">Welcome to Nomi</h3>
                        <p class="animated fadeInDown">DeFi NFTs on XRPL</p>
                        <span id="show_wallet"></span>
                        <ul class="nav navbar-nav">
                           <!-- SPACE -->
                        </ul>
                    </div>
                    <div class="col-md-6 col-sm-12">


                    </div>
                </div>
            </div>

            <div class="col-md-12" style="padding:20px;">
                <div class="col-md-12 padding-0">
                    <div class="col-md-8 padding-0">
                        <div class="col-md-12 padding-0">
                            <div class="col-md-6">
                                <div class="panel box-v1">
                                    <div class="panel-heading bg-white border-none">
                                        <div class="col-md-6 col-sm-6 col-xs-6 text-left padding-0">
                                            <h4 class="text-left">NFTs You Hold</h4>
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                                            <h4>
                                                <span class="icon-user icons icon text-right"></span>
                                            </h4>
                                        </div>
                                    </div>
                                    <div class="panel-body text-center">
                                        <h1><span id="held_nfts"></span></h1>
                                        <p>NFTs</p>
                                        <hr/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="panel box-v1">
                                    <div class="panel-heading bg-white border-none">
                                        <div class="col-md-6 col-sm-6 col-xs-6 text-left padding-0">
                                            <h4 class="text-left">Minted NFTs</h4>
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                                            <h4>
                                                <span class="icon-basket-loaded icons icon text-right"></span>
                                            </h4>
                                        </div>
                                    </div>
                                    <div class="panel-body text-center">
                                        <h1><span id="minted_nfts"></span></h1>
                                        <p>Minted</p>
                                        <hr/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="panel box-v4">
                                <div class="panel-heading bg-white border-none">
                                    <h4><span class="icon-picture icons"></span> Mint your Next NFT</h4>
                                </div>
                                <div class="panel-body padding-0">
                                    <div class="col-md-12 box-v4-alert">
                                     
                                        <div class="panel">
                                  
                                            <div class="panel-body">
                                                <label for="nft_name">NFT Name</label>
                                                <input id="nft_name" type="text">
                                            </div>
                                            <div class="panel-body">
                                                <label for="nft_description">Description</label>
                                                <input id="nft_description" type="text">
                                            </div>
                                            <div class="panel-body">
                                                <label for="nft_keywords">Keywords</label>
                                                <input id="nft_keywords" type="text">
                                            </div
                                            <div class="panel-body">
                                                <input type="file" id="nft_mint_upload">
                                            </div>
                                            <div class="panel-body">
                                                <label for="nft_description">Base Stake</label>
                                                <select id="nft_stake">
                                                    <option value="50000">50000</option>
                                                    <option value="150000">150000</option>
                                                    <option value="250000">250000</option>
                                                    <option value="550000">550000</option>
                                                </select>
                                            </div
                                        </div>
                                        <div class="col-md-6" style="margin-top:5px;">
                                            <button id="nft_mint_button" class="btn ripple-infinite btn-gradient btn-info">
                                                <div>
                                                  <span>Mint</span>
                                                </div>
                                            </button>
                                        </div>
                                    </div>

                                </div>
                                <div class="panel-body padding-0 bg-white">
                                    <!--Hello  -->
                                    <span id="mint_display"></span>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="col-md-12 padding-0">
                  
                        </div>

                        <div class="col-md-12 padding-0">
                            <img src="asset/img/android-icon-96x96.png">
                        </div>

                        <div class="col-md-12 padding-0">
                            <!-- SPACE -->
                        </div>
                    </div>
                </div>

                <div class="col-md-12 card-wrap padding-0">
                    <div class="col-md-6">
                       <!-- SPACE -->
                    </div>

                    <div class="col-md-6">
                      <!-- SPACE -->
                       
                    </div>
                </div>
                <div class="col-md-12">
                    <!-- SPACE -->
                </div>
            </div>
        </div>
        <!-- end: content -->

    </div>
    
    <!-- start: Mobile -->
    <div id="mimin-mobile" class="reverse">
        <div class="mimin-mobile-menu-list">
            <div class="col-md-12 sub-mimin-mobile-menu-list animated fadeInLeft">
                <ul class="nav nav-list">
                    <li class="active ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa-home fa"></span>Dashboard
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="dashboard-v1.html">Dashboard v.1</a></li>
                            <li><a href="dashboard-v2.html">Dashboard v.2</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa-diamond fa"></span>Layout
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="topnav.html">Top Navigation</a></li>
                            <li><a href="boxed.html">Boxed</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa-area-chart fa"></span>Charts
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="chartjs.html">ChartJs</a></li>
                            <li><a href="morris.html">Morris</a></li>
                            <li><a href="flot.html">Flot</a></li>
                            <li><a href="sparkline.html">SparkLine</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa fa-pencil-square"></span>Ui Elements
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="color.html">Color</a></li>
                            <li><a href="weather.html">Weather</a></li>
                            <li><a href="typography.html">Typography</a></li>
                            <li><a href="icons.html">Icons</a></li>
                            <li><a href="buttons.html">Buttons</a></li>
                            <li><a href="media.html">Media</a></li>
                            <li><a href="panels.html">Panels & Tabs</a></li>
                            <li><a href="notifications.html">Notifications & Tooltip</a></li>
                            <li><a href="badges.html">Badges & Label</a></li>
                            <li><a href="progress.html">Progress</a></li>
                            <li><a href="sliders.html">Sliders</a></li>
                            <li><a href="timeline.html">Timeline</a></li>
                            <li><a href="modal.html">Modals</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa fa-check-square-o"></span>Forms
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="formelement.html">Form Element</a></li>
                            <li><a href="#">Wizard</a></li>
                            <li><a href="#">File Upload</a></li>
                            <li><a href="#">Text Editor</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa fa-table"></span>Tables
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="datatables.html">Data Tables</a></li>
                            <li><a href="handsontable.html">handsontable</a></li>
                            <li><a href="tablestatic.html">Static</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a href="calendar.html">
                            <span class="fa fa-calendar-o"></span>Calendar
                        </a>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa fa-envelope-o"></span>Mail
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="mail-box.html">Inbox</a></li>
                            <li><a href="compose-mail.html">Compose Mail</a></li>
                            <li><a href="view-mail.html">View Mail</a></li>
                        </ul>
                    </li>
                    <li class="ripple">
                        <a class="tree-toggle nav-header">
                            <span class="fa fa-file-code-o"></span>Pages
                            <span class="fa-angle-right fa right-arrow text-right"></span>
                        </a>
                        <ul class="nav nav-list tree">
                            <li><a href="forgotpass.html">Forgot Password</a></li>
                            <li><a href="login.html">SignIn</a></li>
                            <li><a href="reg.html">SignUp</a></li>
                            <li><a href="article-v1.html">Article v1</a></li>
                            <li><a href="search-v1.html">Search Result v1</a></li>
                            <li><a href="productgrid.html">Product Grid</a></li>
                            <li><a href="profile-v1.html">Profile v1</a></li>
                            <li><a href="invoice-v1.html">Invoice v1</a></li>
                        </ul>
                    </li>
                    <li class="ripple"><a class="tree-toggle nav-header"><span class="fa "></span> MultiLevel  <span class="fa-angle-right fa right-arrow text-right"></span> </a>
                        <ul class="nav nav-list tree">
                            <li><a href="view-mail.html">Level 1</a></li>
                            <li><a href="view-mail.html">Level 1</a></li>
                            <li class="ripple">
                                <a class="sub-tree-toggle nav-header">
                                    <span class="fa fa-envelope-o"></span> Level 1
                                    <span class="fa-angle-right fa right-arrow text-right"></span>
                                </a>
                                <ul class="nav nav-list sub-tree">
                                    <li><a href="mail-box.html">Level 2</a></li>
                                    <li><a href="compose-mail.html">Level 2</a></li>
                                    <li><a href="view-mail.html">Level 2</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="credits.html">Credits</a></li>
                </ul>
            </div>
        </div>
    </div>
    <button id="mimin-mobile-menu-opener" class="animated rubberBand btn btn-circle btn-danger">
        <span class="fa fa-bars"></span>
      </button>
    <!-- end: Mobile -->

      <!-- Connect Modal --> 
      <div class="modal fade modal-v2" id="connect_modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="col-md-3 modal-content-center">
                    <img src="../asset/img/apple-icon-114x114.png">
                </div>
                <div class="col-md-9 modal-content-right">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <p>Enter you wallet seed.</p>
                    <input id="modal_seed_field" type="text" class="modal-content-right-text-mail" />

                    <select id="modal_select_field"> 
                    <option value="" selected>Select Network</option>
                    <option value="wss://xls20-sandbox.rippletest.net:51233">NFT DEVNET</option>
                    <option value="wss://s.devnet.rippletest.net:51233">DEVNET</option>
                    <option value="wss://s.altnet.rippletest.net:51233">TESTNET</option>
                    <option value="wss://xrplcluster.com">MAINNET</option>
                  </select>
                    <button id="connect_modal_button" class="btn btn-primary" data-dismiss="modal">Connect</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <!-- start: Javascript -->
    <script src="asset/js/jquery.min.js"></script>
    <script src="asset/js/jquery.ui.min.js"></script>
    <script src="asset/js/bootstrap.min.js"></script>


    <!-- plugins -->
    <script src="asset/js/plugins/moment.min.js"></script>
    <script src="asset/js/plugins/fullcalendar.min.js"></script>
    <script src="asset/js/plugins/jquery.nicescroll.js"></script>
    <script src="asset/js/plugins/jquery.vmap.min.js"></script>
    <script src="asset/js/plugins/maps/jquery.vmap.world.js"></script>
    <script src="asset/js/plugins/jquery.vmap.sampledata.js"></script>
    <script src="asset/js/plugins/chart.min.js"></script>
    <script src="asset/js/plugins/dropzone.js"></script>

    <script>
        
        const ipfs = window.IpfsHttpClientLite('https://ipfs.infura.io:5001')

        console.log("got ipfs: " + ipfs);

        var client;
        var account;

        var connected; 

        const storage = window.localStorage; 

        const modalConnectButton = ge("connect_modal_button");
        modalConnectButton.addEventListener('click', connectXRPL);
        modalConnectSelect      = ge("modal_select_field");

        const modalSeedField    = ge("modal_seed_field");
        const showWallet        = ge("show_wallet");

        const nameField         = ge("nft_name");
        const descriptionField  = ge("nft_description");
        const keywords          = ge("nft_keywords");
        const nftMintUpload     = ge("nft_mint_upload");
        const mintDisplay       = ge("mint_display");
        const nftMintButton     = ge("nft_mint_button");

        const features          = "";

        nftMintButton.addEventListener('click', uploadToIPFSAndMint);
        
        const connectXRPLButton = ge("connect_xrpl_button");
        connectXRPLButton.addEventListener('click', showConnectModal);
        const connectXRPLText = ge("connect_xrpl_text");
        connectXRPLText.innerHTML = "Connect XRPL"; 
        const connectXRPLBackText = ge("connect_xrpl_back_text");
        connectXRPLBackText.innerHTML = " NFT Testnet?"; 
        var connected = false; 

        function showConnectModal() { 
            if(!connected) {
                $('#connect_modal').modal('show');
            }
            else{ 
                connectXRPL(); 
            }
        }

        async function connectXRPL() {
            console.log(connected);
            if(!connected) {
                    client = new xrpl.Client(modalConnectSelect.value);
                    client.connect()
                    .then(function(response) {
                        console.log(client.isConnected());
                        account = xrpl.Wallet.fromSeed(modalSeedField.value);
                        console.log(account);

                        client.request({
                            "command": "account_info",
                            "account": account.address,
                            "ledger_index": "validated"
                        })
                        .then(function(response){
                            console.log(response);
                            showWallet.innerHTML = "Connected Account :: " + account.classicAddress + " Balance :: "+ response.result.account_data.Balance;
                            storage.setItem("xrpl_connection", client);
                            storage.setItem("xrpl_connection", client);    
                    connectXRPLText.innerHTML = "XRPL Connected"; 
                    connectXRPLBackText.innerHTML = "Disconnect XRPL?";  
                            getNFTCount();
                            listNFTs();
                        })
                        .catch(function(err){
                            console.log(err);
                        })
                    })
            }
            else { 
                console.log("connected : " + connected);
                client.disconnect(); 
                console.log("connected : " + client.isConnected());
                showWallet.innerHTML = "Disconnected"; 
                connected = false; 
                console.log("client disconnected ");
            }
        }

        var nfts;
        const heldNFTsSpan = ge("held_nfts");
        const mintedNFTsSpan = ge("minted_nfts");
        async function getNFTCount() { 
            client.request({
                    method: "account_nfts",
                    account: account.classicAddress
                })
                .then(function(response) {
                    console.log(response);
                    var nfts = response.result.account_nfts;
                    var held = nfts.length; 
                    heldNFTsSpan.append(text(held));
                    var minted = calculateMinted(nfts);
                    mintedNFTsSpan.append(text(minted));
                })
                .catch(function(err) {
                    console.log(err);
                })
        }

        function ge(element) {
            return document.getElementById(element);
        }

        function ce(element){
            return document.createElement(element);
        }

        function cell(row) {
            return row.insertCell();
        }

        function text(txt) {
            return document.createTextNode(txt);
        }

        function calculateMinted(nfts) {
            console.log(nfts);
            var count = 0; 
            for(var x = 0; x < nfts.length; x++) {
                var issuer = nfts[x].Issuer;
                if(issuer === account.classicAddress){
                    count++;
                }
            }
            return count; 
        }

        const EPOCH = 946684800; 

        function getMintDisplay(result) {            
            var displayTable = ce("table");
            mintDisplay.append(displayTable);
            var row = displayTable.insertRow();
            var ac = cell(row);
            var acv = cell(row);            
            var at = text("Account");
            ac.append(at);           
            var atv = text(result.Account);
            acv.append(atv);
            var feeRow = displayTable.insertRow(); 
            var f = cell(feeRow);
            var fv = cell(feeRow);
            var ft = text("Fee");            
            f.append(ft);
            var ftv = text(result.hash);
            fv.append(ftv);
            var dateRow = displayTable.insertRow(); 
            var d = cell(dateRow);
            var dv = cell(dateRow);
            var dt = text("Date");
            d.append(dt);
            var dtv = text(new Date((result.date+EPOCH) * 1000));
            dv.append(dtv);
        }

        async function uploadToIPFSAndMint() {

            console.log(nftMintUpload.value);
            console.log(nftMintUpload.files[0]);

            var reader = new FileReader();

            reader.readAsArrayBuffer(nftMintUpload.files[0]);

            console.log(reader.result);

            ipfs.add(nftMintUpload.files[0])
            .then(function(response) {
                console.log(response);
                var ipfsHash =  ""+response[0].hash;
                console.log(ipfsHash);
                mintToken(ipfsHash);
            })
            .catch(function(err) {
                console.log(err);
            })
        }

        async function checkConnected() {
            var client = storage.getItem("xrpl_client");
            console.log("connected: " + connected);
            if(connected == null || client == undefined || client.isConnected() == false){
              $('#connect_modal').modal('show');
            }
        }

        async function mintToken(ipfsHash) {
            console.log("hash to mint : " + ipfsHash);
            var transactionBlob = {

                TransactionType: "NFTokenMint",
                Account: account.classicAddress,
                URI: xrpl.convertStringToHex(ipfsHash + ""),
                Flags : parseInt("8"),
                TokenTaxon: 0
            }

            console.log(transactionBlob);

            var wallet = account; 
            client.submitAndWait(transactionBlob, {wallet})
            .then(function(response) {
                console.log(response);
                getMintDisplay(response.result);

            })
            .catch(function(err) {
                console.log(err);
            })
        }
    </script>

    <!-- custom -->
    <script src="asset/js/main.js"></script>
    <!-- end: Javascript -->
</body>

</html>